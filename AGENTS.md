# Repository Guidelines

## Project Structure & Module Organization
- lib/: Core library (`jkinds_lib`) with kinds, modalities, parsers, solvers.
- bin/: CLI entrypoint (`main.ml`) exposing the `jkinds` executable.
- test/: Unit, property, and expect tests (ppx_expect). Sample programs live in `test/types/*.types`.
- scripts/: Utilities like `run_types.sh` to generate `types_report.md`.
- dune files: Build definitions; `_build/` is generated by Dune.

## Build, Test, and Development Commands
- dune build: Compile library and binary.
- dune exec jkinds -- test/types/ref.types [--max-iters N]: Run the CLI on a sample types file.
- dune runtest: Run the full test suite, including expect tests.
- scripts/run_types.sh [OUT_PATH]: Build and run the CLI over all `test/types/*.types` and write a consolidated report (env: `MAX_ITERS_FLAG` to pass `--max-iters`).

## Coding Style & Naming Conventions
- OCaml formatting is enforced by ocamlformat (see `.ocamlformat`). Use `dune fmt` before sending a PR.
- Modules: `Snake_case.ml/mli`; public module names in `lib/dune` list define exposure.
- Functions/values use snake_case; constructors and modules use Capitalized.
- Keep modules focused (parsing, lattices, inference) and avoid cyclic deps.

## Testing Guidelines
- Frameworks: Dune tests + ppx_expect inline tests. Add unit tests as `test_*.ml` and expect tests under the `expect_lib` library.
- Run tests with `dune runtest`. For intentional output changes, use `dune runtest --auto-promote` (or `dune promote`) to update snapshots.
- Prefer small, deterministic cases; reuse helpers in `test/poly_support.ml`.

## Commit & Pull Request Guidelines
- Commits: concise, imperative mood (e.g., "Fix kind normalization"), one logical change per commit. Reference issues when relevant.
- PRs: include a clear description, test coverage for new logic, and CLI output screenshots or report diffs if behavior changes. Link related issues and note breaking changes.

## Architecture Overview
- Binary (`bin/main.ml`) parses a `.types` program, runs classic and polynomial inference, and prints normalized kinds and relations.
- Library (`lib/`) is the source of truth; add new features here, then expose via CLI.

